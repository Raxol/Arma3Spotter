"use strict";function validInteger(){function a(a,b,c,d){d&&d.$parsers.push(function(a){if(angular.isUndefined(a))var a="";var b=parseInt(a);if(_.isNumber(b)&&!_.isNaN(b)){var e=parseInt(c.max),f=parseInt(c.min);_.isNumber(f)&&!_.isNaN(f)&&_.isNumber(e)&&!_.isNaN(e)&&(f>b&&(b=f),b>e&&(b=e))}else b="-"===a?"-":""===a?"":0;var g=b.toString();return a!==g&&(d.$setViewValue(g),d.$render()),g})}var b={require:"?ngModel",restrict:"A",link:a};return b}function validDecimal(){function a(a,b,c,d){d&&d.$parsers.push(function(a){angular.isUndefined(a)&&(a="");var b=!1,c=parseFloat(a);_.isNumber(c)&&!_.isNaN(c)&&(b=!0);var e=c.toString();return a===e||b||(d.$setViewValue(e),d.$render()),e})}var b={require:"?ngModel",restrict:"A",link:a};return b}angular.module("arma3SpotterApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","pascalprecht.translate"]),function(){function a(a,d){try{var e="0.1.0",f=localStorage.getItem("version");(f&&f!=e||!f)&&(localStorage.clear(),localStorage.setItem("version",e))}catch(g){alert("localStorage \n"+g.stack)}d.when("/spotter",{templateUrl:"views/spotter.html",controller:"SpotterCtrl",controllerAs:"Spotter",activeTab:"spotter"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl",controllerAs:"Settings",activeTab:"settings"}).otherwise({redirectTo:"/spotter"});try{a.translations("en",c).translations("de",b).registerAvailableLanguageKeys(["en","de"],{en_US:"en",en_UK:"en",en_GB:"en",de_DE:"de",de_AT:"de",de_CH:"de"}).preferredLanguage("en")}catch(g){alert("translateProvider \n"+g.stack)}}angular.module("arma3SpotterApp").config(a),a.$inject=["$translateProvider","$routeProvider"];var b={SETTINGS:"Einstellungen",SETTINGS_MOD:"Mod",SETTING_WEAPON:"Waffe",SETTINGS_AMMO:"Munition",SETTINGS_SAVE:"Speichern",SPOTTER:"Spotter",SPOTTER_DISTANCE:"Entfernung",SPOTTER_ANGLE:"Winkel",SPOTTER_HEADWIND:"Gegenwind",SPOTTER_CROSSWIND:"Seitenwind",SPOTTER_TEMPERATURE:"Temperatur",SPOTTER_CALCULATE:"Berechnen",SPOTTER_HORIZONTAL:"Horizontal",SPOTTER_VERTICAL:"Vertikal"},c={SETTINGS:"Settings",SETTINGS_MOD:"Mod",SETTING_WEAPON:"Weapon",SETTINGS_AMMO:"Ammo",SETTINGS_SAVE:"Save",SPOTTER:"Spotter",SPOTTER_DISTANCE:"Distance",SPOTTER_ANGLE:"Angle",SPOTTER_HEADWIND:"Headwind",SPOTTER_CROSSWIND:"Crosswind",SPOTTER_TEMPERATURE:"Temperature",SPOTTER_CALCULATE:"Calculate",SPOTTER_HORIZONTAL:"Horizontal",SPOTTER_VERTICAL:"Vertical"}}(),angular.module("arma3SpotterApp").directive("validInteger",validInteger),angular.module("arma3SpotterApp").directive("validDecimal",validDecimal),function(){function a(a,b){function c(){try{return a.get("data/weapons.json").then(d)["catch"](e)}catch(b){alert("$http.get \n"+b.stack)}}function d(a){return a.data}function e(a){b.logError("XHR failed for getWeapons."+a.data)}return{getWeapons:c}}angular.module("arma3SpotterApp").factory("DataService",a),a.$inject=["$http","logger"]}(),function(){function a(){return{logError:function(a){console.log(a)}}}angular.module("arma3SpotterApp").service("logger",a)}(),function(){function a(){function a(a){try{if(!a||""===a)throw new Error("StorageService.getItem: Key is empty!");var b=localStorage.getItem(a);if(b&&""!==b){var c=JSON.parse(b);return c.item}return null}catch(d){alert("setItem \n"+d.stack)}}function b(a,b){try{if(!a||""===a)throw new Error("StorageService.setItem: Key is empty!");if(!b)throw new Error("StorageService.setItem: Item is null!");"object"==typeof b?localStorage.setItem(a,JSON.stringify({type:"object",item:b})):"string"==typeof b&&localStorage.setItem(a,JSON.stringify({type:"string",item:b}))}catch(c){alert("setItem \n"+c.stack)}}return{getItem:a,setItem:b}}angular.module("arma3SpotterApp").factory("StorageService",a)}(),function(){function a(a){function b(){try{if(!f.activeAmmo){var b=a.getItem("activeAmmo");d(b)}return f.activeAmmo}catch(c){alert("getActiveAmmo \n"+c.stack)}}function c(){try{if(!f.activeWeapon){var b=a.getItem("activeWeapon");e(b)}return f.activeWeapon}catch(c){alert("getActiveWeapon \n"+c.stack)}}function d(a){a&&"object"==typeof a&&(f.activeAmmo=a)}function e(a){a&&"object"==typeof a&&(f.activeWeapon=a)}var f={activeWeapon:null,activeAmmo:null};return{getActiveAmmo:b,getActiveWeapon:c,setActiveAmmo:d,setActiveWeapon:e}}angular.module("arma3SpotterApp").factory("Data",a),a.$inject=["StorageService"]}(),function(){function a(a,b,c){function d(){c.trackPageView("/spotter");try{j.activeAmmo=j.Data.getActiveAmmo(),j.activeWeapon=j.Data.getActiveWeapon(),j.activeAmmo||b.logError("activeAmmo not set. No weapon has been selected."),j.activeWeapon||b.logError("activeWeapon not set. No weapon has been selected.")}catch(a){alert("spotter.init \n"+a.stack)}}function e(){if(!j.activeAmmo)return void alert("No weapon has been selected. Please navigate to 'Settings' and select a weapon.");var a=j.Data.getActiveAmmo(),b=Math.min(Math.max(parseInt(j.distance),1),3e3),d=Math.min(Math.max(parseInt(j.angle),-80),80),e=Math.min(Math.max(parseFloat(j.headwind),-15),15),f=Math.min(Math.max(parseFloat(j.crosswind),-15),15),g=Math.min(Math.max(parseFloat(j.temperature),-50),50),h=i(a,b,d,e,f,45);if(h[0]<0)return j.resultHorizontal=0,void(j.resultVertical=0);var k=d,l=45;h=i(a,b,d,e,f,g,k);for(var m,n,o=h[0],p=h[1];Math.abs(o)>.1;)h=i(a,b,d,e,f,g,l),m=h[0],p=h[1],n=l-m*(l-k)/(m-o),k=l,l=n,o=m;try{var q=17.77777*(k-d);if(q=Math.round(10*q)/10,isNaN(q))throw"HairOnFire";j.resultVertical=q}catch(r){j.resultVertical=0}try{var s=Math.atan(p/b)*(180/Math.PI)*17.77777;if(s=Math.round(10*s)/10,isNaN(s))throw"HairOnFire";j.resultHorizontal=s}catch(r){j.resultHorizontal=0}c.trackEvent("Spotter - Calculate","click",j.Data.getActiveWeapon().name)}function f(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2))}function g(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}function h(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function i(a,b,c,d,e,i,j){var k=a.initSpeed,l=a.airFriction,m=a.timeToLive,n=a.simulationStep,o=293.15/(273.15+i);j*=Math.PI/180,c*=Math.PI/180,d*=-1;var p=[Math.cos(c)*b,Math.sin(c)*b,0],q=[0,0,0],r=k*(((i+273.13)/288.13-1)/2.5+1-1),s=[Math.cos(j)*(k+r),Math.sin(j)*(k+r),0];n=Math.min(n,.001);for(var t=Math.floor(m/n),u=0;t>u;u++){var v=f(s);if(s[0]+=n*s[0]*v*l,s[1]+=n*(s[1]*v*l-9.81),s[2]+=n*s[2]*v*l,s=g(g(s,h(s,v*(o-1)*l*n)),h([d,0,e],-1*f(g(s,[d,0,e]))*l*n)),q=g(q,h(s,n)),q[0]>=p[0])break}return[q[1]-p[1],q[2]]}var j=this;j.activeAmmo={},j.activeWeapon={},j.angle=0,j.calculate=e,j.crosswind=0,j.Data=a,j.distance=1e3,j.headwind=0,j.temperature=30,j.resultHorizontal=0,j.resultVertical=0,c.setPageData("/spotter","Spotter"),d()}angular.module("arma3SpotterApp").controller("SpotterCtrl",a),a.$inject=["Data","logger","Analytics"]}(),function(){function a(a,b,c,d){function e(){return d.trackPageView("/settings"),a.getWeapons().then(function(a){return m.allWeapons=a,m.allWeapons.forEach(function(a){-1===m.mods.indexOf(a.mod)&&m.mods.push(a.mod)}),m.mods.sort(function(a,b){return a>b?1:-1}),i(),m.allWeapons})}function f(){c.setActiveWeapon(m.activeWeapon),c.setActiveAmmo(m.activeAmmo)}function g(){m.weapons=[],m.allWeapons.forEach(function(a){a.mod===m.activeMod&&m.weapons.push(a)}),m.weapons.sort(function(a,b){return a.name>b.name?1:-1}),j()}function h(){var a=b.getItem("activeAmmo");if(a){for(var c=!1,d=0;d<m.ammos.length;d++)if(m.ammos[d].name===a.name){m.activeAmmo=m.ammos[d],c=!0;break}c===!1&&(m.activeAmmo=m.ammos[0])}else m.activeAmmo=m.ammos[0];f()}function i(){var a=b.getItem("activeMod");if(a&&""!==a){var c=m.mods.indexOf(a);m.activeMod=c>=0&&m.mods.length>c?m.mods[c]:m.mods[0]}else m.activeMod=m.mods[0];g()}function j(){var a=b.getItem("activeWeapon");if(a){for(var c=!1,d=0;d<m.weapons.length;d++)if(m.weapons[d].name===a.name){m.activeWeapon=m.weapons[d],c=!0;break}c===!1&&(m.activeWeapon=m.weapons[0])}else m.activeWeapon=m.weapons[0];k()}function k(){m.ammos=m.activeWeapon.magazines,m.ammos.sort(function(a,b){return a.name>b.name?1:-1}),h()}function l(){b.setItem("activeMod",m.activeMod),b.setItem("activeWeapon",m.activeWeapon),b.setItem("activeAmmo",m.activeAmmo)}var m=this;m.activeAmmo="",m.activeMod="",m.activeWeapon="",m.allWeapons=[],m.ammoChanged=f,m.ammos=[],m.modChanged=g,m.mods=[],m.saveConfig=l,m.weaponChanged=k,m.weapons=[],d.setPageData("/settings","Settings"),e()}angular.module("arma3SpotterApp").controller("SettingsCtrl",a),a.$inject=["DataService","StorageService","Data","Analytics"]}(),function(){function a(a){var b=this;b.route=a}angular.module("arma3SpotterApp").controller("HeaderCtrl",a),a.$inject=["$route"]}(),function(){function a(){function a(a,b,c,d){try{ga("send","event",a,b,c,d)}catch(e){}}function b(a){try{ga("send","pageview",a)}catch(b){}}function c(a,b){ga("set",{page:a,title:b})}return{trackEvent:a,trackPageView:b,setPageData:c}}angular.module("arma3SpotterApp").factory("Analytics",a)}();